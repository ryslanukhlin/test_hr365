import { MapContainer, TileLayer, Marker, Popup, Polyline } from 'react-leaflet';
import L from 'leaflet';
import icon from 'leaflet/dist/images/marker-icon.png';
import iconShadow from 'leaflet/dist/images/marker-shadow.png';
import '../style/Map.css';

const position = [56.319976973083115, 43.981175016510726];

let DefaultIcon = L.icon({
    iconUrl: icon,
    shadowUrl: iconShadow,
});

L.Marker.prototype.options.icon = DefaultIcon;

const geometry =
    'LINESTRING(44.009834 56.292537, 44.009323 56.292466, 44.009323 56.292466, 44.009150 56.292442, 44.009150 56.292442, 44.008990 56.292420, 44.008990 56.292420, 44.008605 56.292368, 44.008605 56.292368, 44.008076 56.292295, 44.008076 56.292295, 44.007740 56.292249, 44.007740 56.292249, 44.007140 56.292166, 44.007140 56.292166, 44.006738 56.292111, 44.006738 56.292111, 44.005862 56.291991, 44.005862 56.291991, 44.005010 56.291874, 44.005010 56.291874, 44.004827 56.291849, 44.004827 56.291849, 44.004039 56.291740, 44.004039 56.291740, 44.003839 56.291713, 44.003839 56.291713, 44.002574 56.291559, 44.002574 56.291559, 44.001528 56.291416, 44.001528 56.291416, 44.000467 56.291270, 44.000467 56.291270, 43.999471 56.291133, 43.999471 56.291133, 43.999414 56.291125, 43.999414 56.291125, 43.998331 56.290977, 43.998331 56.290977, 43.997149 56.290814, 43.997149 56.290814, 43.996505 56.290725, 43.996505 56.290725, 43.996007 56.290657, 43.995747 56.290622, 43.995556 56.290603, 43.995556 56.290603, 43.995480 56.290602, 43.995480 56.290602, 43.995404 56.290602, 43.995404 56.290602, 43.995339 56.290601, 43.995123 56.290613, 43.994673 56.290653, 43.994673 56.290653, 43.994545 56.290664, 43.994545 56.290664, 43.993778 56.290732, 43.993778 56.290732, 43.993337 56.290771, 43.993337 56.290771, 43.992142 56.290878, 43.992142 56.290878, 43.991223 56.290960, 43.991223 56.290960, 43.990649 56.291011, 43.990649 56.291011, 43.989006 56.291157, 43.989006 56.291157, 43.988556 56.291197, 43.988556 56.291197, 43.988390 56.291212, 43.988390 56.291212, 43.987294 56.291309, 43.987294 56.291309, 43.986636 56.291368, 43.986636 56.291368, 43.986019 56.291423, 43.986019 56.291423, 43.985693 56.291452, 43.985693 56.291452, 43.984349 56.291571, 43.984349 56.291571, 43.983510 56.291646, 43.983510 56.291646, 43.982980 56.291693, 43.982668 56.291721, 43.982668 56.291721, 43.982552 56.291757, 43.982439 56.291805, 43.982316 56.291869, 43.982209 56.291965, 43.982181 56.292036, 43.982181 56.292036, 43.982405 56.292672, 43.982405 56.292672, 43.982750 56.293652, 43.982750 56.293652, 43.983127 56.294732, 43.983127 56.294732, 43.983467 56.295703, 43.983467 56.295703, 43.983717 56.296419, 43.983717 56.296419, 43.983947 56.297067, 43.983947 56.297067, 43.983957 56.297098, 43.983990 56.297452, 43.983990 56.297452, 43.984001 56.297564, 43.984001 56.297564, 43.984029 56.297865, 43.984029 56.297865, 43.984086 56.298486, 43.984086 56.298486, 43.984138 56.299042, 43.984138 56.299042, 43.984145 56.299103, 43.984145 56.299103, 43.984154 56.299177, 43.984154 56.299177, 43.984174 56.299389, 43.984174 56.299389, 43.984263 56.300363, 43.984263 56.300363, 43.984331 56.301104, 43.984331 56.301104, 43.984396 56.301787, 43.984396 56.301787, 43.984405 56.301880, 43.984405 56.301880, 43.984481 56.302718, 43.984481 56.302718, 43.984554 56.303526, 43.984554 56.303526, 43.984467 56.303533, 43.984376 56.303555, 43.984376 56.303555, 43.983909 56.303672, 43.983909 56.303672, 43.983184 56.303736, 43.983184 56.303736, 43.981329 56.303884, 43.981329 56.303884, 43.981364 56.304016, 43.981364 56.304016, 43.981485 56.304479, 43.981485 56.304479, 43.981638 56.305066, 43.981638 56.305066, 43.981653 56.305120, 43.981653 56.305120, 43.981737 56.305443, 43.981737 56.305443, 43.981762 56.305537, 43.981762 56.305537, 43.981850 56.305872, 43.981850 56.305872, 43.982349 56.306069, 43.982349 56.306069, 43.983439 56.306500, 43.983700 56.306583, 43.983700 56.306583, 43.983826 56.306623, 43.983826 56.306623, 43.983974 56.306670, 43.983974 56.306670, 43.984161 56.306679, 43.984892 56.306607, 43.984892 56.306607, 43.984965 56.306491, 43.984801 56.305923, 43.984801 56.305923, 43.984638 56.305301, 43.984638 56.305301, 43.984470 56.304664, 43.984470 56.304664, 43.984412 56.304441, 43.984395 56.304021)';

const routeCoordinate = geometry.slice(11, -1).replace(/,/g, '').split(' ');
const routeCoodinateArray = [];
for (let index = 1; index < routeCoordinate.length; index = index + 2) {
    routeCoodinateArray.push([routeCoordinate[index], routeCoordinate[index - 1]]);
}
const startCoordinate = [56.292699836941104, 44.00981445050729];
const endCoordinate = [56.30401826580248, 43.98422958047019];

const Map = ({ width }) => {
    return (
        <div
            className="map__container"
            style={{ width: `calc(100% - ${width}px)`, left: width + 6 + 'px' }}>
            <MapContainer center={position} zoom={13} scrollWheelZoom={false} className="map">
                <TileLayer
                    attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
                />
                <Marker position={startCoordinate}>
                    <Popup>
                        A pretty CSS3 popup. <br /> Easily customizable.
                    </Popup>
                </Marker>
                <Marker position={endCoordinate}>
                    <Popup>
                        A pretty CSS3 popup. <br /> Easily customizable.
                    </Popup>
                </Marker>
                <Polyline positions={routeCoodinateArray}></Polyline>
            </MapContainer>
        </div>
    );
};

export default Map;
